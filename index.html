<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SHINKANSEN AR: KISARAGI_STATION</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Noto+Serif+JP:wght@900&display=swap');

:root {
  --blood: #770000;
  --neon: #ff0000;
}

body {
  background: #030000;
  color: var(--neon);
  font-family: 'Share Tech Mono', 'Noto Serif JP', serif;
  overflow: hidden;
  height: 100vh;
}

/* CRT 扫描线 */
body::after {
  content: " ";
  display: block;
  position: fixed;
  top: 0; left: 0; bottom: 0; right: 0;
  background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.4) 50%),
              linear-gradient(90deg, rgba(255, 0, 0, 0.04), rgba(0, 0, 0, 0), rgba(255, 0, 0, 0.04));
  z-index: 1000;
  background-size: 100% 4px, 3px 100%;
  pointer-events: none;
}

/* 故障效果 */
.glitch {
  position: relative;
  animation: glitch-anim 0.5s infinite linear alternate-reverse;
}
@keyframes glitch-anim {
  0% { transform: translate(0); text-shadow: 1px 0 blue; }
  50% { transform: translate(-2px, 1px); text-shadow: -1px 0 red; }
  100% { transform: translate(0); }
}

/* 跳脸层 */
#scare-overlay {
  display: none;
  position: fixed; inset: 0;
  z-index: 9999;
  background: #000;
  justify-content: center; align-items: center;
}
.scare-img {
  width: 100%; height: 100%; object-fit: cover;
  filter: contrast(400%) grayscale(1);
  animation: shake 0.04s infinite;
}
@keyframes shake {
  0% { transform: translate(10px, 10px); }
  50% { transform: translate(-20px, -10px); }
  100% { transform: translate(10px, 20px); }
}

.terminal-border {
  border: 1px solid var(--blood);
  background: rgba(10, 0, 0, 0.9);
  backdrop-filter: blur(5px);
}

.btn-horror {
  border: 1px solid var(--neon);
  transition: all 0.3s;
  background: rgba(150, 0, 0, 0.1);
}
.btn-horror:hover {
  background: var(--neon);
  color: black;
  box-shadow: 0 0 30px var(--neon);
}

.hidden { display: none !important; }

/* 解锁时的白光闪烁 */
.flash-white {
  animation: flash 0.5s ease-out;
}
@keyframes flash {
  0% { background: #fff; }
  100% { background: transparent; }
}
</style>
</head>
<body class="flex flex-col p-6">

<div id="scare-overlay">
  <img src="https://images.unsplash.com/photo-1509248961158-e54f6934749c?q=80&w=2000" class="scare-img">
</div>

<!-- Header -->
<header class="flex justify-between items-center text-[10px] mb-4 border-b border-red-900 pb-2 opacity-60">
  <div class="flex items-center gap-2">
    <span class="w-2 h-2 bg-red-600 rounded-full animate-ping"></span>
    TOKAIDO_SKS_TERMINAL_2026
  </div>
  <div class="tracking-[0.4em]">東京発 ≫≫≫ 新大阪行</div>
  <div id="clock">00:00:00</div>
</header>

<main class="flex-grow grid grid-cols-12 gap-6 overflow-hidden">
  
  <!-- LEFT: ROUTE STATUS -->
  <aside class="col-span-3 flex flex-col gap-4">
    <div class="terminal-border p-4 flex-grow overflow-y-auto">
      <h2 class="text-[11px] mb-4 text-red-500 font-bold border-b border-red-900 pb-1">運行状況 (STATUS)</h2>
      <div id="station-list" class="space-y-5 text-[10px] opacity-30">
        <div id="st-tokyo">● 東京駅 (出発)</div>
        <div id="st-atami">○ 熱海 (長大トンネル)</div>
        <div id="st-shizuoka">○ 静岡 (富士山付近)</div>
        <div id="st-seki">○ 関ヶ原 (境界通過)</div>
        <div id="st-kyoto">○ 京都駅 (最終調整)</div>
        <div id="st-osaka">○ 新大阪 (終着)</div>
      </div>
    </div>
    <div class="terminal-border p-3 text-[8px] text-red-900 italic">
        ※ 聖地巡礼ミッション遂行中。下車時の忘れ物にご注意ください。
    </div>
  </aside>

  <!-- CENTER: MAIN AR INTERFACE -->
  <section class="col-span-6 flex flex-col relative">
    <div id="main-viewport" class="terminal-border flex-grow flex flex-col items-center justify-center p-10 relative">
      
      <!-- STEP 1: START -->
      <div id="ui-start" class="text-center">
        <h1 class="text-7xl font-black mb-4 glitch">きさらぎ駅</h1>
        <p class="text-[10px] tracking-[1em] mb-12 opacity-50">SHINKANSEN AR SYSTEM</p>
        <button onclick="startJourney()" class="btn-horror px-20 py-5 text-sm font-bold">
          接続を開始する (CONNECT)
        </button>
      </div>

      <!-- STEP 2: AR PROCESSING -->
      <div id="ui-ar" class="hidden w-full text-center">
        <div id="announcement" class="text-2xl font-serif mb-12 h-20 flex items-center justify-center leading-relaxed">
            GPS信号を待機しています...
        </div>
        <div class="relative w-48 h-48 mx-auto">
            <div class="absolute inset-0 border-4 border-red-900 rounded-full animate-ping opacity-20"></div>
            <div class="absolute inset-4 border-2 border-red-600 rounded-full animate-pulse flex items-center justify-center">
                <span class="text-[10px]">SCANNING</span>
            </div>
        </div>
      </div>

      <!-- STEP 3: PRE-REWARD (UNLOCK BUTTON) -->
      <div id="ui-arrival" class="hidden text-center">
        <h2 class="text-4xl font-bold mb-6 glitch text-white">目的地到着</h2>
        <p class="text-sm mb-12 opacity-80">異界との境界が安定しました。<br>巡礼報酬の封印を解除してください。</p>
        <button onclick="unlockReward()" class="btn-horror px-12 py-5 text-sm font-bold bg-red-900/30">
          報酬を解禁する (UNLOCK)
        </button>
      </div>

      <!-- STEP 4: FINAL REWARD & REDIRECT -->
      <div id="ui-reward" class="hidden text-center">
        <h2 class="text-4xl font-bold mb-4 glitch">巡礼完了報酬</h2>
        <div class="bg-white p-4 inline-block mb-6 shadow-[0_0_50px_rgba(255,255,255,0.2)]">
            <img id="qr-img" src="" class="w-44 h-44">
        </div>
        <p class="text-[11px] mb-8 text-red-400">
            デジタル御守と10%割引券を発行しました。<br>
            下のボタンから公式サイトへ移動し、詳細を確認してください。
        </p>
        <button onclick="handleRedirect()" class="btn-horror px-16 py-4 text-sm font-bold bg-red-600 text-black">
          公式サイトへ移動 (GO TO SITE)
        </button>
      </div>

    </div>
  </section>

  <!-- RIGHT: TELEMETRY DATA -->
  <aside class="col-span-3 flex flex-col gap-4">
    <div class="terminal-border p-4 h-1/2">
      <h2 class="text-[11px] mb-4 text-red-400 font-bold border-b border-red-900 pb-1">TELEMETRY</h2>
      <div class="text-5xl font-bold italic mb-2" id="speed">0 <span class="text-xs">km/h</span></div>
      <div class="text-[9px] opacity-40 space-y-2">
        <p>LAT: <span id="lat">---</span></p>
        <p>LNG: <span id="lng">---</span></p>
        <p>STATUS: <span id="sys-status" class="text-green-600">STANDBY</span></p>
      </div>
    </div>
    <div class="terminal-border p-4 flex-grow overflow-hidden">
        <h2 class="text-[11px] mb-2 text-red-400 font-bold border-b border-red-900 pb-1">LOG</h2>
        <div id="log" class="text-[8px] space-y-1 opacity-40 leading-tight">
          <p>> Initializing Terminal...</p>
        </div>
    </div>
  </aside>
</main>

<footer class="mt-4 flex justify-between text-[8px] opacity-20 border-t border-red-900 pt-2">
  <div>ID: KSRG-SYS-2026 | 企画：新幹線ARホラー体験</div>
  <div>聖地巡礼スポット：新大阪駅コンコース付近</div>
</footer>

<script>
// 路线与提示语
const journeyMap = [
  { id: 'st-tokyo', name: '東京', msg: '東京を発車しました。', log: 'Journey Start: Tokyo' },
  { id: 'st-atami', name: '熱海', msg: 'まもなく熱海。トンネルが長く続きます...', log: 'Tunnel Environment Detected' },
  { id: 'st-shizuoka', name: '静岡', msg: '富士山が見えます。振り返らないでください。', log: 'Scanning Mt.Fuji/Forest Area' },
  { id: 'st-seki', name: '関ヶ原', msg: '警告：関ヶ原。境界線との干渉が激化しています。', log: 'CRITICAL ERROR: BOUNDARY_INTERFERENCE', scare: true },
  { id: 'st-kyoto', name: '京都', msg: '次は京都。そこには誰が立っていますか？', log: 'Approaching Kyoto Sanctuary' },
  { id: 'st-osaka', name: '新大阪', msg: '終点、新大阪。現実界へ戻る準備を。', log: 'Destination Reached.' }
];

let audioCtx, drone, gainNode;

function addLog(m) {
  const l = document.getElementById('log');
  const p = document.createElement('p');
  p.innerText = `> ${m}`;
  l.prepend(p);
}

function startJourney() {
  document.getElementById('ui-start').classList.add('hidden');
  document.getElementById('ui-ar').classList.remove('hidden');
  document.getElementById('sys-status').innerText = "TRACKING";
  document.getElementById('sys-status').className = "text-red-600";
  
  // 背景音
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  drone = audioCtx.createOscillator();
  gainNode = audioCtx.createGain();
  drone.type = 'sine';
  drone.frequency.setValueAtTime(45, audioCtx.currentTime);
  gainNode.gain.setValueAtTime(0.06, audioCtx.currentTime);
  drone.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  drone.start();

  runLogic();
}

function runLogic() {
  let step = 0;
  const timer = setInterval(() => {
    if(step < journeyMap.length) {
      const data = journeyMap[step];
      document.getElementById('announcement').innerText = data.msg;
      document.getElementById('announcement').classList.add('glitch');
      setTimeout(() => document.getElementById('announcement').classList.remove('glitch'), 400);
      
      document.getElementById(data.id).classList.replace('opacity-30', 'text-white');
      addLog(data.log);

      if(data.scare) {
        setTimeout(triggerScare, 1200);
      }
      step++;
    } else {
      clearInterval(timer);
      document.getElementById('ui-ar').classList.add('hidden');
      document.getElementById('ui-arrival').classList.remove('hidden');
      addLog("System awaiting reward decryption.");
    }
  }, 4500);
}

function triggerScare() {
  const overlay = document.getElementById('scare-overlay');
  overlay.style.display = 'flex';
  
  const osc = audioCtx.createOscillator();
  osc.type = 'sawtooth';
  osc.frequency.setValueAtTime(800, audioCtx.currentTime);
  osc.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + 0.3);

  setTimeout(() => overlay.style.display = 'none', 300);
}

// 核心更新：点击按钮解锁二维码
function unlockReward() {
  // 视觉反馈
  const viewport = document.getElementById('main-viewport');
  viewport.classList.add('flash-white');
  setTimeout(() => viewport.classList.remove('flash-white'), 500);

  // 界面切换
  document.getElementById('ui-arrival').classList.add('hidden');
  document.getElementById('ui-reward').classList.remove('hidden');
  
  // 生成QR
  const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=REWARD_TOKEN_2026_KSRG&color=990000`;
  document.getElementById('qr-img').src = qrUrl;
  
  addLog("Reward decrypted. Redirect available.");
  gainNode.gain.rampToValueAtTime(0, audioCtx.currentTime + 2);
}

// 跳转逻辑
function handleRedirect() {
  // 企划书指定的活动页或JR领券页
  const targetUrl = "https://www.westjr.co.jp/global/en/shinkansen/";
  window.location.href = targetUrl;
}

// 数据模拟
setInterval(() => {
  document.getElementById('clock').innerText = new Date().toLocaleTimeString('ja-JP', {hour12: false});
  if(document.getElementById('ui-start').classList.contains('hidden')) {
    const s = 270 + Math.floor(Math.random()*20);
    document.getElementById('speed').innerHTML = `${s} <span class="text-xs">km/h</span>`;
    document.getElementById('lat').innerText = (34.7 + Math.random()).toFixed(4);
    document.getElementById('lng').innerText = (135.2 + Math.random()).toFixed(4);
  }
}, 1000);
</script>
</body>
</html>
