<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>幻の停車駅・きさらぎ</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700&family=Share+Tech+Mono&display=swap');

body {
    background:#050505;
    color:#dcdcdc;
    font-family:'Share Tech Mono','Noto Serif JP',monospace;
    overflow:hidden;
}

.hidden { display:none; }

/* 扫描线 */
.scanlines {
    position:fixed;
    inset:0;
    pointer-events:none;
    background:linear-gradient(
        rgba(255,255,255,0) 50%,
        rgba(0,0,0,0.25) 50%
    );
    background-size:100% 4px;
    z-index:60;
}

/* 故障文字 */
.glitch { position:relative; color:#ff4444; }
.glitch::before,.glitch::after{
    content:attr(data-text);
    position:absolute; inset:0;
}
.glitch::before{ left:2px; text-shadow:-1px 0 red; animation:g1 2s infinite; }
.glitch::after{ left:-2px; text-shadow:1px 0 blue; animation:g2 3s infinite; }

@keyframes g1{
    0%{clip-path:inset(20% 0 70% 0)}
    50%{clip-path:inset(50% 0 20% 0)}
    100%{clip-path:inset(10% 0 60% 0)}
}
@keyframes g2{
    0%{clip-path:inset(60% 0 10% 0)}
    50%{clip-path:inset(30% 0 40% 0)}
    100%{clip-path:inset(80% 0 5% 0)}
}

/* === 红色异常动画（关键升级点） === */
.anomaly-active {
    animation: anomalyFade 1s ease-out forwards;
}

@keyframes anomalyFade {
    0%   { opacity:0; }
    15%  { opacity:0.45; }
    60%  { opacity:0.3; }
    100% { opacity:0; }
}
</style>
</head>

<body class="w-screen h-screen flex items-center justify-center relative">

<!-- 异常覆盖层 -->
<div id="anomalyOverlay"
     class="pointer-events-none fixed inset-0 hidden z-50 bg-red-900">
</div>

<div class="scanlines"></div>

<!-- START -->
<div id="start" class="text-center p-6 max-w-md z-10">
    <h1 class="text-4xl font-bold mb-2 glitch" data-text="きさらぎ駅">きさらぎ駅</h1>
    <p class="text-xs text-gray-400 mb-6">幻の停車駅・体験デモ</p>

    <div class="border border-red-800 p-4 text-xs text-red-400 mb-6">
        <ul class="list-disc pl-4 space-y-1">
            <li>本体験は演出用デモです</li>
            <li>イヤホンの使用を推奨します</li>
            <li>画面から目を離さないでください</li>
        </ul>
    </div>

    <button onclick="startGame()" class="border border-red-600 w-full py-3">
        接続開始
    </button>
</div>

<!-- RIDE -->
<div id="ride" class="hidden w-full h-full p-6 flex flex-col z-10">
    <div class="flex justify-between text-xs text-green-500 mb-6">
        <span>GPS：作動中</span>
        <span>想定速度：285 km/h（確認中）</span>
    </div>

    <div class="flex-grow flex flex-col items-center justify-center">
        <div class="w-56 h-56 border border-green-500/30 rounded-full flex items-center justify-center animate-pulse">
            <span class="text-xs text-green-400">ルート解析中</span>
        </div>
        <p class="mt-4 text-sm text-gray-400">次の通過地点：トンネル</p>
        <p class="mt-2 text-[10px] text-gray-500">※ 乗客情報を確認中です</p>
    </div>

    <button
    onclick="triggerEvent()"
    class="border border-gray-600 py-2 text-xs mt-6 mb-4
           relative bottom-4">
    デバッグ：イベント発生
</button>

</div>

<!-- EVENT -->
<div id="eventScreen" class="hidden w-full h-full flex flex-col items-center justify-center bg-black z-10">
    <h2 class="text-6xl font-bold glitch mb-2" data-text="警告">警告</h2>
    <p class="text-red-500 text-sm mb-2">異常を検知しました</p>
    <p class="text-[10px] text-gray-500 mb-6">乗客データが見つかりません</p>

    <div class="border-y border-red-700 w-full py-10 text-center text-sm">
        「ここは、あなたが来るべき場所ではありません……」
    </div>

    <button onclick="finishGame()" class="mt-12 border border-red-800 px-6 py-2">
        脱出
    </button>
</div>

<!-- END -->
<div id="end" class="hidden w-full h-full flex flex-col items-center justify-center p-8 text-center z-10">
    <div class="border-4 border-white p-2 mb-6">
        <div class="bg-white text-black p-4">
            <h3 class="font-bold">きさらぎ駅</h3>
            <p class="text-xs">KISARAGI STATION</p>
        </div>
    </div>

    <p class="text-sm mb-4">あなたは終点に到達しました</p>
    <p class="text-[10px] text-gray-500 mb-6">※ 到達できた理由は不明です</p>

    <div class="bg-gray-800 p-4 w-full mb-4">
        <p class="text-xs text-gray-400">報酬解放</p>
        <p class="text-lg text-yellow-400 font-bold">駅限定クーポン</p>
    </div>

    <button onclick="showCoupon()" class="bg-red-700 w-full py-3">
        受け取る
    </button>
</div>

<!-- COUPON -->
<div id="coupon"
     class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-[999]">
    <div class="bg-white text-black p-6 w-72 text-center">
        <p class="text-xs mb-2">駅限定クーポン</p>

        <img
            src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=あなたは、まだ……"
            class="mx-auto mb-4"
        >

      

        <button onclick="closeCoupon()" class="border px-4 py-1 text-xs">
            閉じる
        </button>
    </div>
</div>

<script>
const startScreen  = document.getElementById('start');
const rideScreen   = document.getElementById('ride');
const eventScreen  = document.getElementById('eventScreen');
const endScreen    = document.getElementById('end');
const couponModal  = document.getElementById('coupon');
const anomalyLayer = document.getElementById('anomalyOverlay');

function flashAnomaly(){
    anomalyLayer.classList.remove('hidden','anomaly-active');
    void anomalyLayer.offsetWidth; // 强制重绘
    anomalyLayer.classList.add('anomaly-active');

    setTimeout(() => {
        anomalyLayer.classList.add('hidden');
        anomalyLayer.classList.remove('anomaly-active');
    }, 1000);
}

function startGame(){
    startScreen.classList.add('hidden');
    rideScreen.classList.remove('hidden');
    flashAnomaly();
}

function triggerEvent(){
    rideScreen.classList.add('hidden');
    eventScreen.classList.remove('hidden');
    flashAnomaly();
}

function finishGame(){
    eventScreen.classList.add('hidden');
    endScreen.classList.remove('hidden');
}

function showCoupon(){
    anomalyLayer.classList.add('hidden'); // 关键：确保不遮挡
    couponModal.classList.remove('hidden');
}

function closeCoupon(){
    couponModal.classList.add('hidden');
}
</script>

</body>
</html>
